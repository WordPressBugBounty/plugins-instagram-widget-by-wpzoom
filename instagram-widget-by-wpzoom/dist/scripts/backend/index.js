(()=>{"use strict";function t(i){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(i)}jQuery(function(i){var n,a,e,s=i();if(i.fn.imageMediaControl=function(){this.each(function(){var t=i(this),n={frame:function(){return this._frame||(this._frame=wp.media({title:t.data("title"),library:{type:t.data("type")},button:{text:t.data("button")},multiple:!1,selection:[]}),this._frame.on("open",this.updateFrame).state("library").on("select",this.select)),this._frame},select:function(){var i,n,a=t.find(".attachment-input").add(s.find("input#wpz-insta_account-photo")),e=this.get("selection"),o=e.pluck("id");a.val(""+o).trigger("change");var d=e.first().toJSON(),p=null!==(i=null===(n=d.sizes.thumbnail)||void 0===n?void 0:n.url)&&void 0!==i?i:d.sizes.full.url;s.find("img.wpz-insta_profile-photo").attr("src",""+p)},updateFrame:function(){},init:function(){var a=t.find(".file-wrapper"),e=t.find(".attachment-input, #wpz-insta_account-photo"),o=t.find(".add-media, #wpz-insta_edit-account-photo"),d=t.find(".remove-avatar, #wpz-insta_reset-account-photo");o.on("click",function(t){t.preventDefault(),s=i(this).closest(".wpz-insta_account-photo-wrapper"),n.frame().open()}),d.on("click",function(t){t.preventDefault(),i("#the-list input.wpz-insta_profile-photo-input").val("-1").trigger("change"),i("#the-list img.wpz-insta_profile-photo").attr("src",zoom_instagram_widget_admin.default_user_thumbnail)}),e.on("change",function(n){n.preventDefault();var e=t.find(".attachment-input").val();e?(o.text(t.data("button-replace-text")),d.show(),wp.media.attachment(e).fetch().then(function(t){a.fadeOut(400,function(){var n=t.url;_.findKey(t,"thumbnail")&&(n=t.sizes.thumbnail.url),i(this).html('<img width="150" height="150" src="'+n+'"/>').fadeIn(400)})})):(a.hide(),d.hide(),o.text(t.data("button-add-text")))}).trigger("change")}};n.frame().on("open",function(){var i=t.find(".attachment-input, #wpz-insta_account-photo"),a=n.frame(),e=a.state().get("selection"),s=i.val(),o=wp.media.attachment(s);a.reset(),o.id&&e.add(o)}),n.init()})},i(".zoom-instagram-user-avatar-media-uploader, .inline-edit-wpz-insta_user .wpz-insta_quick-edit-columns .wpz-insta_two-columns").imageMediaControl(),i("#wpzoom_instagram_clear_data").on("click",function(t){t.preventDefault();var n={action:"wpzoom_instagram_clear_data",nonce:i(this).data("nonce")},a=i(this);window.confirm("Are you sure?")&&(a.text("Removing data..."),i.post(zoom_instagram_widget_admin.ajax_url,n,function(t){t.success&&(a.text("Done!"),a.prop("disabled",!0),a.next().html(t.data.message))}))}),i(window).on("beforeunload",function(t){i.isEmptyObject(l)||c||t.preventDefault()}),i("#the-list").on("click","#wpz-insta_reconnect",function(t){t.preventDefault(),i(this).attr("href").length>0&&window.wpzInstaAuthenticateInstagram(i(this).attr("href"))}),i(".wpzoom-instagram-widget-settings-request-type-wrapper").find("input[type=radio]").on("change",function(t){t.preventDefault();var n=i(this).val(),a=["with-access-token","with-basic-access-token","without-access-token"].filter(function(t){return t!==n}),e=i(this).closest(".form-table");e.find(".wpzoom-instagram-widget-"+n+"-group").show(),a.forEach(function(t){e.find(".wpzoom-instagram-widget-"+t+"-group").hide()})}),i(".wpzoom-instagram-widget-settings-request-type-wrapper").find("input[type=radio]:checked").change(),setTimeout(function(){if("hash"in window.location&&""!=(""+window.location.hash).trim()){var t=i(".edit-php.post-type-wpz-insta_user #the-list").find((""+window.location.hash).trim());t.length>0&&t.find("button.editinline").trigger("click")}},100),window.opener&&window.location.hash.length>1||(n=window.outerWidth,a=window.outerHeight,n<window.screen.width&&a<window.screen.height&&(n>=700&&n<=960)&&(a>=750&&a<=1200)&&window.location.hash.length>1)){if(window.opener&&"function"==typeof window.opener.wpzInstaHandleReturnedToken)window.opener.wpzInstaHandleReturnedToken(window.location),window.close();else{var o=(window.location,(e=window.location.href.split("#")[1])&&e.includes("access_token=")?new URLSearchParams(e).get("access_token"):null),d=i("#wpz-insta_modal-dialog-connection-failed");i("#wpz_generated_token").text(o),d.addClass("open"),i("#wpfooter").show()}window.location.hash.includes("access_graph_token")&&(window.opener.wpzInstaHandleReturnedGraphToken(window.location),window.close())}i("#screen-meta #wpz-insta_account-photo-hide, #screen-meta #wpz-insta_account-bio-hide, #screen-meta #wpz-insta_account-token-hide, #screen-meta #wpz-insta_actions-hide").closest("label").remove(),i("#titlediv").remove(),i("#title").length>0&&(i("#title").attr("size",i("#title").val().trim().length+3),i("#title").on("input",function(){i(this).attr("size",i(this).val().trim().length+3)})),i(".wpz-insta_feed-edit-nav").length>0&&(window.location.hash&&g(window.location.hash),i(".wpz-insta_feed-edit-nav a").on("click",function(){g(i(this).attr("href"))})),i("#wpz-insta_show-pro").on("change",function(t){t.preventDefault(),i(this).closest(".wpz-insta_sidebar").toggleClass("show-pro",this.checked)}),i("#wpz-insta_connect-personal, #wpz-insta_connect-business, .wpz-insta_tabs-config-connect-add").each(function(){var t=i(this).attr("href");if(t){var n=btoa(encodeURIComponent(zoom_instagram_widget_admin.feeds_url)),a=t.replace("RETURN_URL",n);i(this).attr("href",a)}}),i(".wpz-insta-wrap .account-options .account-option-button").on("click",function(t){t.preventDefault(),i(this).is(".disabled")||(i(this).is("#wpz-insta_connect-personal")||i(this).is("#wpz-insta_connect-business")?window.wpzInstaAuthenticateInstagram(i(this).attr("href")):i(this).is("#wpz-insta_account-token-button")?window.wpzInstaHandleReturnedGraphToken(i("#wpz-insta_account-token-input").val().trim().replace(/[^a-z0-9-_.]+/gi,""),!0):i(this).is("#wpz-insta-biz_account-token-button")&&window.wpzInstaHandleReturnedToken(i("#wpz-insta_biz_account-token-input").val().trim().replace(/[^a-z0-9-_.]+/gi,""),!0))}),i("#wpz-insta_account-token-input").on("input",function(){i("#wpz-insta_account-token-button").toggleClass("disabled",i("#wpz-insta_account-token-input").val().trim().length<=0)}),i("#wpz-insta_biz_account-token-input").on("input",function(){i("#wpz-insta-biz_account-token-button").toggleClass("disabled",i("#wpz-insta_biz_account-token-input").val().trim().length<=0)}),i('.wpz-insta_sidebar-section-layout input[name="_wpz-insta_layout"]').on("change",function(){var t=i(this).closest(".wpz-insta_sidebar-section-layout").find('input[name="_wpz-insta_col-num"]').closest(".wpz-insta_table-row"),n=i(this).closest(".wpz-insta_sidebar-section-layout").find('input[name="_wpz-insta_perpage-num"]').closest(".wpz-insta_table-row"),a=i(this).closest(".wpz-insta_sidebar-section-layout").find(".wpz-insta_table-row-featured-layout"),e=a.closest(".wpz-insta_feed-only-pro"),s=i(this).closest(".wpz-insta_sidebar-left-section"),o=s.find(".wpz-insta_sidebar-section-feed .wpz-insta_show-on-hover fieldset.wpz-insta_feed-only-pro.wpz-insta_pro-only"),d=s.find(".wpz-insta_sidebar-section-load-more");t.add(o).add(d).toggleClass("hidden","1"==i(this).val()||"3"==i(this).val()),i(".wpz-insta-admin .wpz-insta_widget-preview .wpz-insta_widget-preview-view").toggleClass("layout-fullwidth","1"==i(this).val()),a.toggleClass("hidden","0"!=i(this).val()),i(".wpz-insta_sidebar .wpz-insta_sidebar-left").hasClass(".is-pro")||e.toggleClass("hidden","0"!=i(this).val()),n.toggleClass("hidden","3"!=i(this).val())}),i('.wpz-insta_sidebar-section-layout input[name="_wpz-insta_col-num"]').on("input",function(){if("0"==i('.wpz-insta_sidebar-section-layout input[name="_wpz-insta_layout"]:checked').val()){var t=parseInt(i(this).closest(".wpz-insta_sidebar-section-layout").find('input[name="_wpz-insta_col-num"]').val()),n=i(this).closest(".wpz-insta_table").find("label.featured-layout"),a=n.closest(".wpz-insta_table-row");t<3||t>6?a.addClass("hidden"):(a.removeClass("hidden"),n.addClass("hidden"),n.each(function(){i(this).is(".featured-layout-columns_"+t)&&i(this).removeClass("hidden")}))}}),i('.wpz-insta_sidebar-section-layout input[name="_wpz-insta_col-num_responsive-enabled"]').on("change",function(){i(this).closest(".wpz-insta_responsive-table-row").toggleClass("wpz-insta_responsive-enabled",i(this).is(":checked"))}),i('.wpz-insta_sidebar-section-layout input[name="_wpz-insta_perpage-num_responsive-enabled"]').on("change",function(){i(this).closest(".wpz-insta_responsive-table-row").toggleClass("wpz-insta_responsive-enabled",i(this).is(":checked"))}),i("#_wpz-insta_featured-layout-enable").on("change",function(){i(this).closest(".wpz-insta_table-row").find(".wpz-insta_image-select").toggleClass("hidden",!i(this).is(":checked"))}),i("#wpz-insta_modal-dialog").find(".wpz-insta_modal-dialog_ok-button, .wpz-insta_modal-dialog_close-button").on("click",function(t){t.preventDefault();var n=i("#wpz-insta_modal-dialog");window.wpzInstaCloseConnectDoneDialog(n.hasClass("success"),n.hasClass("update"))}),i("#wpz-insta_modal_graph-dialog").find(".wpz-insta_modal-dialog_ok-button, .wpz-insta_modal-dialog_close-button").on("click",function(t){t.preventDefault(),i("#wpz-insta_modal_graph-dialog").removeClass("open")}),i("#wpz-insta_modal-dialog-connection-failed").find(".wpz-insta_modal-dialog_ok-button, .wpz-insta_modal-dialog_close-button").on("click",function(t){t.preventDefault();var n=i("#wpz-insta_modal-dialog-connection-failed");window.close(),n.removeClass("open")}),i("#wpz-insta_feed-user-select-btn").on("click",function(t){t.preventDefault(),i("#wpz-insta_tabs-config-cnnct").removeClass("active").addClass("active").prev(".wpz-insta_sidebar").removeClass("active"),i("#wpz-insta_tabs-config-cnnct").closest(".wpz-insta_tabs-content").find("> .wpz-insta_sidebar").addClass("hide")}),i("#wpz-insta_feed-user-remove-btn").on("click",function(t){t.preventDefault();var n=i("#wpz-insta_feed-user-select-btn").closest(".wpz-insta_feed-user-select"),a=n.find(".wpz-insta_feed-user-select-info");i("#wpz-insta_user-id").val("-1").trigger("change"),i("#wpz-insta_user-token").val("-1").trigger("change"),i("#wpz-insta_user-token, #wpz-insta_check-new-posts-interval-number, #wpz-insta_enable-request-timeout").closest(".wpz-insta_sidebar-section").removeClass("active"),i("#wpz-insta_widget-preview-links").addClass("disabled"),i(".wpz-insta_widget-preview-refresh").addClass("disabled").prop("disabled",!0),n.removeClass("is-set"),a.find(".wpz-insta_feed-user-select-info-name").html("None"),a.find(".wpz-insta_feed-user-select-info-type").html("None"),n.closest(".wrap").find(".wpz-insta_settings-header .wpz-insta_feed-edit-nav li:not(:first-child)").addClass("disable")}),i("#wpz-insta_tabs-config-cnnct .wpz-insta_tabs-config-connect-accounts li").on("click",function(t){t.preventDefault();var n=i("#wpz-insta_feed-user-select-btn").closest(".wpz-insta_feed-user-select"),a=n.find(".wpz-insta_feed-user-select-info");i("#wpz-insta_user-id").val(i(this).data("user-id")).trigger("change"),i("#wpz-insta_user-token").val(i(this).data("user-token")).trigger("change"),i("#wpz-insta_user-token, #wpz-insta_check-new-posts-interval-number, #wpz-insta_enable-request-timeout").closest(".wpz-insta_sidebar-section").addClass("active"),n.addClass("is-set"),a.find(".wpz-insta_feed-user-select-info-name").html(i(this).data("user-name")),a.find(".wpz-insta_feed-user-select-info-type").html(i(this).data("user-type")),n.closest(".wrap").find(".wpz-insta_settings-header .wpz-insta_feed-edit-nav li").removeClass("disable"),n.find(".wpz-insta_feed-user-select-edit-link").attr("href",zoom_instagram_widget_admin.edit_user_url+i(this).data("user-id")),i("#wpz-insta_widget-preview-links").removeClass("disabled"),i(".wpz-insta_widget-preview-refresh").removeClass("disabled").prop("disabled",!1);var e=1===i(this).data("has-page-id")||"1"===i(this).data("has-page-id"),s=i('input[name="_wpz-insta_show-stories"]').not('[type="hidden"]').closest(".wpz-insta_table-row"),o=s.find('input[type="checkbox"]');e?(s.removeClass("wpz-insta_disabled"),o.prop("disabled",!1)):(s.addClass("wpz-insta_disabled"),o.prop("disabled",!0).prop("checked",!1)),i("#wpz-insta_tabs-config-cnnct").removeClass("active").prev(".wpz-insta_sidebar").addClass("active"),i("#wpz-insta_tabs-config-cnnct").closest(".wpz-insta_tabs-content").find("> .wpz-insta_sidebar").removeClass("hide")});var p={},r={},l={},c=!1;function w(t){var n=[];return i('input[name="'+t+'"]').each(function(){i(this).is(":checked")&&n.push(i(this).val())}),n.sort().join(",")}function u(){var t=i("#_wpz-insta_product-links-display-type");if(t.length){var n=t.closest(".wpz-insta_sidebar-left-section"),a="icon"===t.find('input[name="_wpz-insta_product-links-display-type"]:checked').val();n.find(".wpz-insta-product-links-popover-title-row").toggleClass("hidden",!a),n.find(".wpz-insta-product-links-icon-position-row").toggleClass("hidden",!a),n.find(".wpz-insta_sidebar-section-product-links-icon-design").toggleClass("hidden",!a),n.find(".wpz-insta-buy-now-button-row").toggleClass("hidden",a),n.find(".wpz-insta_sidebar-section-product-links-design").toggleClass("hidden",a)}}function g(t){if(t){var n=i('.wpz-insta_feed-edit-nav a[href="'+t+'"]'),a=n.closest("form").find(".wpz-insta_tabs-content .wpz-insta_sidebar-left-section");n.closest(".wpz-insta_feed-edit-nav").find("li").removeClass("active"),n.closest("li").addClass("active"),a.removeClass("active"),a.filter('[data-id="'+t+'"]').addClass("active");var e=document.querySelector("#wpz-insta_widget-preview-view iframe");if(e&&e.contentWindow){var s=(t+"").replace(/^#/,"");e.contentWindow.postMessage({action:"wpz-insta-tab-change",tab:s},"*")}}}function m(t){var i,n=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;return function(){for(var e=arguments.length,s=new Array(e),o=0;o<e;o++)s[o]=arguments[o];clearTimeout(i),i=setTimeout(function(){t.apply(n,s)},a)}}if(i("form#post .wpz-insta_tabs-content > .wpz-insta_sidebar > .wpz-insta_sidebar-left").find("input, textarea, select").add("form#post #title").filter("[name][name!='']").each(function(t){var n=i.trim(i(this).attr("name"));if(i(this).is(":radio"))i(this).is(":checked")&&(p[n]=i(this));else if(n.endsWith("[]")){var a=n.replace("[]","");p[a]||(p[a]=[]),p[a].push(i(this))}else p[n]=i(this)}),i.each(p,function(t,n){Array.isArray(n)?r[t]=w(t+"[]"):r[t]=n.is(":checkbox")?n.is(":checked")?"1":"0":i.trim(""+n.val())}),i("form#post").on("submit",function(){return c=!0}),i("form#post #title, form#post .wpz-insta_tabs-content > .wpz-insta_sidebar > .wpz-insta_sidebar-left").on("input change",m(function(t){var n=i(t.target),a=n.attr("name");if(a){var e,s=a;a.endsWith("[]")?(s=a.replace("[]",""),e=w(a)):e=n.is(":checkbox")?n.is(":checked")?"1":"0":i.trim(""+n.val()),s in r&&e!=r[s]?s in l||(l[s]=!0):s in l&&delete l[s],i("input#publish").toggleClass("disabled",i.isEmptyObject(l)),"post_title"===a||n.is(".preview-exclude")||(-1!==h.indexOf(a)||a&&0===a.indexOf("_wpz-insta_allowed-post-types")?window.wpzInstaReloadPreview():z())}},300)),i(function(){var t=i("#wpz-insta_widget-preview-view iframe");t.attr("src")&&""!==t.attr("src")||window.wpzInstaReloadPreview()}),i("#wpz-insta_widget-preview-links .wpz-insta_widget-preview-header-link").on("click",function(){i(this).hasClass("active")||(i(this).addClass("active").siblings(".wpz-insta_widget-preview-header-link").removeClass("active"),i(this).closest(".wpz-insta_widget-preview").find(".wpz-insta_widget-preview-view").removeClass("wpz-insta_widget-preview-size-desktop wpz-insta_widget-preview-size-tablet wpz-insta_widget-preview-size-mobile").addClass(i(this).hasClass("wpz-insta_widget-preview-header-links-tablet")?"wpz-insta_widget-preview-size-tablet":i(this).hasClass("wpz-insta_widget-preview-header-links-mobile")?"wpz-insta_widget-preview-size-mobile":"wpz-insta_widget-preview-size-desktop"))}),i("#wpz-insta_widget-preview-view").on("transitionend",function(){var t=i(this).find("iframe");t.height(parseInt(t.contents().find("body").prop("scrollHeight"))+20)}),i("#wpz-insta_widget-preview-view iframe").on("load",function(){if(i(this).removeClass("wpz-insta_preview-hidden"),i(this).closest(".wpz-insta_sidebar-right").addClass("hide-loading"),z(),this.contentWindow){var t=i(".wpz-insta_feed-edit-nav li.active a").attr("href");if(t){var n=(t+"").replace(/^#/,"");this.contentWindow.postMessage({action:"wpz-insta-tab-change",tab:n},"*")}}}),i(".wpz-insta_color-picker").wpColorPicker({change:function(t,n){var a=i.Event("change");a.target=t.target,i(t.target).closest("form#post").find(".wpz-insta_tabs-content > .wpz-insta_sidebar > .wpz-insta_sidebar-left").triggerHandler(a)}}),u(),i(document).on("change",'input[name="_wpz-insta_product-links-display-type"]',u),i(".wpzinsta-pointer").each(function(){i(this).parent().addBack().one("click",function(t){t.stopPropagation();var n=i(this);i(this).is("li")&&(n=i(this).find(".wpzinsta-pointer")),n.remove()})}),i("#post-body-content .wpz-insta_sidebar .wpz-insta_sidebar-left .wpz-insta_sidebar-left-section").on("scroll",function(){i(this).find(".wp-picker-holder").each(function(){var t=i(this).closest(".wp-picker-container"),n=t.offset();i(this).offset({top:n.top+t.outerHeight(),left:n.left})})}).triggerHandler("scroll"),i(window).on("scroll",function(){i("#post-body-content .wpz-insta_sidebar .wpz-insta_sidebar-left .wpz-insta_sidebar-left-section").each(function(){i(this).triggerHandler("scroll")})}),i("#post-body-content .wpz-insta_sidebar .wpz-insta_sidebar-left .wpz-insta_sidebar-left-section .wpz-insta_color-picker").length>0&&new IntersectionObserver(function(t,i){return t.forEach(function(t){return t.target.blur()})},{root:null,threshold:.1}).observe(i("#post-body-content .wpz-insta_sidebar .wpz-insta_sidebar-left .wpz-insta_sidebar-left-section .wpz-insta_color-picker")[0]),i("#wpz-insta_shortcode").on("focus",function(t){t.preventDefault(),i(this).select()}),i("#wpz-insta_shortcode-copy-btn").on("click",m(function(){window.wpzInstaCopyToClipboard(i("#wpz-insta_shortcode").val()).then(function(){i("#wpz-insta_shortcode-copy-btn").addClass("success"),clearTimeout(void 0),setTimeout(function(){i("#wpz-insta_shortcode-copy-btn").removeClass("success")},3e3)})},300)),i(".wpz-insta_actions-menu_copy-shortcode").on("click",function(t){t.preventDefault();var n=i(this).closest("tr").attr("id").replace("post-","");window.wpzInstaCopyToClipboard('[instagram feed="'+n+'"]').then(function(){window.wpzInstaShowDialog(zoom_instagram_widget_admin.i18n_shortcode_success_title,zoom_instagram_widget_admin.i18n_shortcode_success_content,"success update")})}),i(".wpz-insta_actions-menu_delete").on("click",function(t){t.preventDefault();var n=i(this).hasClass("wpz-insta_actions-menu_delete-feed"),a=i(this).find("a").attr("href");window.wpzInstaShowConfirmDialog(zoom_instagram_widget_admin["i18n_delete_"+(n?"feed":"user")+"_confirm_title"],zoom_instagram_widget_admin["i18n_delete_"+(n?"feed":"user")+"_confirm_content"],zoom_instagram_widget_admin.i18n_delete_confirm_button_ok,zoom_instagram_widget_admin.i18n_delete_confirm_button_cancel).then(function(t){!0===t&&(window.location=a),window.wpzInstaCloseDialog()})}),window.wpzInstaAuthenticateInstagram=function(t,i){var n=(window.screen.height-750)/2,a=(window.screen.width-700)/2;window.open(t,"","width=700,height=750,left="+a+",top="+n)},window.wpzInstaParseQuery=function(t){for(var i={},n=("?"===t[0]||"#"===t[0]?t.substr(1):t).split("&"),a=0;a<n.length;a++){var e=n[a].split("=");i[decodeURIComponent(e[0])]=decodeURIComponent(e[1]||"")}return i},window.wpzInstaHandleReturnedGraphToken=function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t){var a=!n&&"hash"in t&&""!=(""+t.hash).trim()?window.wpzInstaParseQuery(""+t.hash):{};if(!n&&!i.isEmptyObject(a)||n&&""!=(""+t).trim()){var e=n?(""+t).trim():"access_graph_token"in a?(""+a.access_graph_token).trim():"-1";if(""!=e&&"-1"!=e){var s={action:"wpz-insta_connect_business-user",nonce:zoom_instagram_widget_admin.nonce,token:e};if(!n){var o="search"in t&&""!=(""+t.search).trim()?window.wpzInstaParseQuery(""+t.search):{};s.post_id=!i.isEmptyObject(o)&&"post"in o?parseInt(o.post):0}i.post(ajaxurl,s).done(function(t,n,a){if("success"==n){var e=i(t);e&&(i("#wpz-insta_modal_graph-dialog").find(".wpz-insta_modal-dialog_content").html(e),i("#wpz-insta_modal_graph-dialog").removeClass().addClass("open success"),i(".wpz-insta_business-accounts-link").on("click",function(t){t.preventDefault(),zoom_instagram_widget_admin.is_pro?i(this).toggleClass("selected"):(i(".wpz-insta_business-accounts-link").removeClass("selected"),i(this).addClass("selected")),i("#wpz-insta-graph-connect-account").removeClass("disabled")}))}}).fail(function(){console.log("Failed to connect business user")})}}}},i("#wpz-insta-select-api").on("change",function(t){var n=i(this).val();i(this).parent().find("#wpz-insta_reconnect").attr("href",n)}),i("#wpz-add_manual_token").on("click",function(t){t.preventDefault(),i("#wpz-insta-token_label").toggle()}),i("#wpz-insta-graph-connect-account").on("click",function(t){t.preventDefault();var n=[],a=i(".wpz-insta_business-accounts-link").parent().data("post-id");if(i(".wpz-insta_business-accounts-link").each(function(){i(this).hasClass("selected")&&n.push(i(this).data("account-info"))}),n.length>0){var e={action:"wpz-insta_connect_business-account",nonce:zoom_instagram_widget_admin.nonce,account_info:JSON.stringify(n),post_id:a};i.post(ajaxurl,e).done(function(t,n,a){"success"==n&&i("#wpz-insta_modal_graph-dialog").removeClass("open"),window.location.replace(zoom_instagram_widget_admin.feeds_url)}).fail(function(t,i,n){console.log(t)})}}),window.wpzInstaShowConnectDoneDialog=function(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];window.wpzInstaShowDialog(t?i?zoom_instagram_widget_admin.i18n_reconnect_success_title:zoom_instagram_widget_admin.i18n_connect_success_title:zoom_instagram_widget_admin.i18n_connect_fail_title,t?i?zoom_instagram_widget_admin.i18n_reconnect_success_content:zoom_instagram_widget_admin.i18n_connect_success_content:zoom_instagram_widget_admin.i18n_connect_fail_content,(t?"success":"fail")+(i?" update":""))},window.wpzInstaShowDialog=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"[DIALOG TITLE]",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"[DIALOG CONTENT]",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"success",e=i("#wpz-insta_modal-dialog"),s=e.find(".wpz-insta_modal-dialog_header-title"),o=e.find(".wpz-insta_modal-dialog_content"),d=(e.find(".wpz-insta_modal-dialog_footer .wpz-insta_modal-dialog_ok-button"),e.find(".wpz-insta_modal-dialog_footer .wpz-insta_modal-dialog_cancel-button"));s.html(""+t),o.html(""+n),d.addClass("hidden"),e.removeClass().addClass("open "+a)},window.wpzInstaShowConfirmDialog=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"[DIALOG TITLE]",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"[DIALOG CONTENT]",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"[OK]",e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"[CANCEL]";return new Promise(function(s,o){var d=i("#wpz-insta_modal-dialog"),p=d.find(".wpz-insta_modal-dialog_header-title"),r=d.find(".wpz-insta_modal-dialog_content"),l=d.find(".wpz-insta_modal-dialog_footer .wpz-insta_modal-dialog_ok-button"),c=d.find(".wpz-insta_modal-dialog_footer .wpz-insta_modal-dialog_cancel-button");p.html(""+t),r.html(""+n),l.removeClass("hidden").html(""+a),l.on("click",function(){return s(!0)}),c.removeClass("hidden").html(""+e),c.on("click",function(){return s(!1)}),d.removeClass().addClass("open confirm")})},window.wpzInstaCloseConnectDoneDialog=function(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];window.wpzInstaCloseDialog(),t&&!i&&window.location.replace(zoom_instagram_widget_admin.feeds_url)},window.wpzInstaCloseDialog=function(){i("#wpz-insta_modal-dialog").removeClass("open")},window.wpzInstaCopyToClipboard=function(t){if(navigator.clipboard&&window.isSecureContext)return navigator.clipboard.writeText(t);var i=document.createElement("textarea");return i.value=t,i.style.position="fixed",i.style.left="-999999px",i.style.top="-999999px",document.body.appendChild(i),i.focus(),i.select(),new Promise(function(t,n){document.execCommand("copy")?t():n(),i.remove()})},"inlineEditPost"in window){i(".inline-edit-save").find(".button-primary").addClass("disabled");var f=window.inlineEditPost.edit;window.inlineEditPost.edit=function(n){f.apply(this,arguments),"object"===t(n)&&(n=window.inlineEditPost.getId(n));for(var a,e,s=["_wpz-insta_account-type","_wpz-insta_token","_wpz-insta_token_expire","_thumbnail_id","wpz-insta_profile-photo","_wpz-insta_user_name","_wpz-insta_user-bio","_wpz-insta_api-url"],o=i("#inline_"+n),d=i("#edit-"+n),p=i("#wpz-insta_reconnect",d),r=0;r<s.length;r++)a=(a=i("."+(e=s[r]),o)).text(),"wpz-insta_profile-photo"==e?i("img."+e).attr("src",a):"_wpz-insta_token"==e?i("#wpz-insta_token",d).val(a):"_wpz-insta_token_expire"==e?i("#wpz-insta_token-expire-time",d).html(a):"_wpz-insta_api-url"==e?i("#wpz-insta_reconnect",d).attr("href",a):i(':input[name="'+e+'"]',d).val(a),i(':input[name="'+e+'"]',d).on("change paste keyup",function(){i(".inline-edit-save",d).find(".button-primary").removeClass("disabled")});i("#wpz-insta-select-api option",d).each(function(){var t=btoa(encodeURIComponent(zoom_instagram_widget_admin.post_edit_url+n)),a=i(this).val();if(a.includes("RETURN_URL")){var e=a.replace("RETURN_URL",encodeURIComponent(t));i(this).val(e)}}),p.attr({href:p.attr("href").replace("RETURN_URL",btoa(encodeURIComponent(zoom_instagram_widget_admin.post_edit_url+n))),"data-user-id":n})}}window.wpzInstaHandleReturnedToken=function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t){var a=!n&&"hash"in t&&""!=(""+t.hash).trim()?window.wpzInstaParseQuery(""+t.hash):{};if(!n&&!i.isEmptyObject(a)||n&&""!=(""+t).trim()){var e=n?(""+t).trim():"access_token"in a?(""+a.access_token).trim():"-1";if(""!=e&&"-1"!=e){var s={action:"wpz-insta_connect-user",nonce:zoom_instagram_widget_admin.nonce,token:e};if(!n){var o="search"in t&&""!=(""+t.search).trim()?window.wpzInstaParseQuery(""+t.search):{};s.post_id=!i.isEmptyObject(o)&&"post"in o?parseInt(o.post):0}i.post(ajaxurl,s).done(function(t){i(".inline-edit-wpz-insta_user #wpz-insta_token").val(e);var n=new Date;n.setDate(n.getDate()+60),i("#the-list #wpz-insta_token-expire-time").html(n.toLocaleDateString("en-US",{weekday:"long",day:"numeric",month:"long",year:"numeric"})),window.wpzInstaShowConnectDoneDialog(t.success,"data"in t&&"update"in t.data&&t.data.update)}).fail(function(){window.wpzInstaShowConnectDoneDialog(!1)})}}}};var h=["_wpz-insta_user-id","_wpz-insta_user-ids","_wpz-insta_item-num","_wpz-insta_allowed-post-types-submitted","_wpz-insta_layout","_wpz-insta_image-size","_wpz-insta_show-overlay","_wpz-insta_hover-link","_wpz-insta_show-likes","_wpz-insta_show-comments","_wpz-insta_show-media-type-icons","_wpz-insta_hover-media-type-icons","_wpz-insta_hover-date","_wpz-insta_show-view-button","_wpz-insta_show-load-more","_wpz-insta_show-stories","_wpz-insta_multi-account-header-mode","_wpz-insta_multi-account-show-attribution"];function z(){var t=document.querySelector("#wpz-insta_widget-preview-view iframe");if(t&&t.contentWindow){var n=function(){var t=i("form#post .wpz-insta_tabs-content > .wpz-insta_sidebar > .wpz-insta_sidebar-left"),n={};return i("form#post #title").add(t.find("input, textarea, select").not(".preview-exclude")).each(function(){var t=i(this),a=t.attr("name");if(a&&"post_ID"!==a){var e,s=a.replace(/^_wpz-insta_/,"").replace(/\[\]$/,"");if(t.is(":radio, :checkbox"))if(-1!==a.indexOf("[]"))e=i("form#post").find('input[name="'+a+'"]:checked').map(function(){return i(this).val()}).get().join(",");else if(t.is(":radio")){var o=i("form#post").find('input[name="'+a+'"]:checked');e=o.length&&o.val()||"0"}else e=t.is(":checked")?t.val()||"1":"0";else e=t.val();n[s]=e}}),n}();t.contentWindow.postMessage({action:"wpz-insta-preview-update",data:n},"*")}}if(window.wpzInstaReloadPreview=function(t){var n=function(t){var n=zoom_instagram_widget_admin.preview_url,a=i('form#post input[name="post_ID"]').val();a&&(n+="&wpz-insta-feed-id="+encodeURIComponent(a));var e=i(".wpz-insta_feed-edit-nav li.active a").attr("href");e&&(n+="&wpz-insta-tab="+encodeURIComponent((e+"").replace(/^#/,""))),h.forEach(function(t){var a=i('form#post [name="'+t+'"]');if(a.length){var e,s=a.filter(":checkbox");s.length&&(a=s),null!=(e=a.is(":checkbox")?a.is(":checked")?"1":"0":i.trim(""+a.val()))&&""!==e&&(n+="&"+encodeURIComponent(t)+"="+encodeURIComponent(e))}});var s=i('form#post input[name="_wpz-insta_allowed-post-types[]"]:checked').map(function(){return i(this).val()}).get().join(",");return s&&(n+="&_wpz-insta_allowed-post-types="+encodeURIComponent(s)),t&&(n+="&wpz-insta-preview-refresh=1"),n}(!!t);i("#wpz-insta_widget-preview-view").closest(".wpz-insta_sidebar-right").removeClass("hide-loading"),i("#wpz-insta_widget-preview-view iframe").addClass("wpz-insta_preview-hidden").attr("src",n)},i(".wpz-insta_widget-preview-refresh").on("click",function(){window.wpzInstaReloadPreview(!0)}),window.wpzInstaUpdatePreviewHeight=function(){var t=i("#wpz-insta_widget-preview-view iframe");t.height(parseInt(t.contents().find("body").prop("scrollHeight")))},"undefined"!=typeof zoom_instagram_widget_admin){var v=function(){var t=i("#wpz-insta-pending-product-links");t.length&&t.val(JSON.stringify(Z)),!i.isEmptyObject(Z)||b()?"_wpz-insta_pending-product-links"in l||(l["_wpz-insta_pending-product-links"]=!0):"_wpz-insta_pending-product-links"in l&&delete l["_wpz-insta_pending-product-links"],i("input#publish").toggleClass("disabled",i.isEmptyObject(l))},b=function(){for(var t=Object.keys(Z),i=0;i<t.length;i++){var n=t[i],a=Z[n]||[],e=$[n]||[];if(JSON.stringify(a)!==JSON.stringify(e))return!0}return!1},k=function(t){return function(t){return t in Z?JSON.parse(JSON.stringify(Z[t])):t in $?JSON.parse(JSON.stringify($[t])):[]}(t).map(function(t){return t.id})},y=function(t){for(var i=0;i<F.length;i++)if(F[i].id===t&&F[i].tag)return!0;return!1},C=function(t,i){for(var n=0;n<t.length;n++)if(t[n].id===i)return n;return-1},I=function(t,i){if(t.length!==i.length)return!1;var n=t.slice().sort(function(t,i){return t.id-i.id}),a=i.slice().sort(function(t,i){return t.id-i.id});return JSON.stringify(n)===JSON.stringify(a)},x=function(){X=null,K=null;var t=zoom_instagram_widget_admin.strings||{};A.find(".wpz-insta-modal-title").text(t.linkProduct||"Link to Product"),A.find("#wpz-insta-tagging-header-preview").hide().empty(),A.find(".wpz-insta-product-selection-view").show(),A.find(".wpz-insta-album-selector-view").hide(),A.find(".wpz-insta-tagging-view").hide(),A.find(".wpz-insta-back-to-products").hide(),A.find(".wpz-insta-modal-footer").show(),A.find(".wpz-insta-tagging-footer").hide();var n=!I(F,G);A.find(".wpz-insta-save-link").prop("disabled",!n),A.find(".wpz-insta-remove-link").prop("disabled",!F.length>0);var a=i("#wpz-insta-product-search-input").val()||"";J(a,1),i("#wpz-insta-tagging-tags").empty(),i("#wpz-insta-tagging-image").attr("src","")},T=function(t,n,a){var e=zoom_instagram_widget_admin.strings||{};A.find(".wpz-insta-modal-title").text(e.selectImage||"Select Image to Tag"),i("#wpz-insta-tagging-product-info").data("product-id",t).data("product-title",n).data("product-image",a),A.find(".wpz-insta-product-selection-view").hide(),A.find(".wpz-insta-album-selector-view").show(),A.find(".wpz-insta-tagging-view").hide(),A.find(".wpz-insta-back-to-products").show(),A.find(".wpz-insta-modal-footer").hide(),S()},S=function(){i("#wpz-insta-album-images").html('<div class="wpz-insta-loading">Loading album images...</div>'),Y.length>0?O(Y):i.ajax({url:zoom_instagram_widget_admin.ajax_url,type:"POST",data:{action:"wpz-insta_get-album-images",nonce:zoom_instagram_widget_admin.product_link_nonce,feed_id:W,media_id:H},success:function(t){t.success&&t.data&&t.data.images?(Y=t.data.images,O(Y)):O(Y=[{url:B,index:0}])},error:function(){O(Y=[{url:B,index:0}])}})},O=function(t){var n=i("#wpz-insta-album-images"),a="";0===t.length?a='<div class="wpz-insta-no-images">No images found in this album.</div>':t.forEach(function(t,i){var n=t.url||t;"video"!==t.type&&(a+='<div class="wpz-insta-album-image-item" data-image-url="'+encodeURIComponent(n)+'" data-image-index="'+i+'"><img src="'+n+'" alt="" /><span class="wpz-insta-album-image-number">'+(i+1)+"</span></div>")}),n.html(a)},D=function(t,n,a,e){var s=zoom_instagram_widget_admin.strings||{};A.find(".wpz-insta-modal-title").text(s.tagProduct||"Tag Product on Image"),i("#wpz-insta-tagging-product-info").data("product-id",t).data("product-title",n).data("product-image",a);var o='<div class="wpz-insta-tagging-product-preview"><img src="'+a+'" alt="" /><span>'+n+"</span></div>";i("#wpz-insta-tagging-header-preview").html(o).show(),i("#wpz-insta-tagging-image").attr("src",decodeURIComponent(e)),A.find(".wpz-insta-product-selection-view").hide(),A.find(".wpz-insta-album-selector-view").hide(),A.find(".wpz-insta-tagging-view").show(),A.find(".wpz-insta-back-to-products").show(),A.find(".wpz-insta-modal-footer").hide(),A.find(".wpz-insta-tagging-footer").show(),L(t),N()},R=function(){var t=i("#wpz-insta-tagging-product-info").data("product-id");if(null!=t){var n=C(F,t);-1!==n&&(F[n].tag=null),i("#wpz-insta-tagging-tags").find('.wpz-insta-tag[data-product-id="'+t+'"]').remove(),Z[H]=JSON.parse(JSON.stringify(F)),v(),N()}},N=function(){var t=i("#wpz-insta-tagging-product-info").data("product-id"),n=null!=t&&i('#wpz-insta-tagging-tags .wpz-insta-tag[data-product-id="'+t+'"]').length>0;A.find(".wpz-insta-remove-tag-position").prop("disabled",!n)},P=function(t,n,a){var e=i("#wpz-insta-tagging-tags"),s=i("#wpz-insta-tagging-product-info").data("product-title")||"";e.find('.wpz-insta-tag[data-product-id="'+t+'"]').remove();var o=i('<div class="wpz-insta-tag" data-product-id="'+t+'" data-x="'+n+'" data-y="'+a+'"><span class="wpz-insta-tag-dot"></span><span class="wpz-insta-tag-label">'+s+"</span></div>");o.css({left:n+"%",top:a+"%"}),e.append(o),E(t,n,a),N(),U(o)},E=function(t,i,n){var a=C(F,t);if(-1!==a){var e={x:i,y:n};e.album_index="carousel_album"===Q&&null!==K?K:null,F[a].tag=e,Z[H]=JSON.parse(JSON.stringify(F)),v();var s=!I(F,G);A.find(".wpz-insta-save-link").prop("disabled",!s)}},U=function(t){var n,a,e,s,o=!1;t.on("mousedown",function(i){(i.target.classList.contains("wpz-insta-tag-dot")||i.target.classList.contains("wpz-insta-tag"))&&(o=!0,n=i.pageX,a=i.pageY,e=parseFloat(t.css("left")),s=parseFloat(t.css("top")),t.addClass("dragging"),i.preventDefault())}),i(document).on("mousemove.tagdrag",function(d){if(o){var p=i("#wpz-insta-tagging-image"),r=p.width(),l=p.height(),c=(d.pageX-n)/r*100,w=(d.pageY-a)/l*100,u=Math.max(0,Math.min(100,e/r*100+c)),g=Math.max(0,Math.min(100,s/l*100+w));u=(e+(d.pageX-n))/r*100,g=(s+(d.pageY-a))/l*100,u=Math.max(0,Math.min(100,u)),g=Math.max(0,Math.min(100,g)),t.css({left:u+"%",top:g+"%"}),t.data("x",u),t.data("y",g)}}),i(document).on("mouseup.tagdrag",function(){if(o){o=!1,t.removeClass("dragging");var i=parseInt(t.data("product-id"),10),n=parseFloat(t.data("x"))||parseFloat(t.css("left")),a=parseFloat(t.data("y"))||parseFloat(t.css("top"));E(i,n,a)}})},L=function(t){var i=C(F,t);if(-1!==i&&F[i].tag){var n=F[i].tag;"carousel_album"===Q&&null!==K?n.album_index===K&&q(t,n.x,n.y):q(t,n.x,n.y)}},q=function(t,n,a){var e=i("#wpz-insta-tagging-tags"),s=i("#wpz-insta-tagging-product-info").data("product-title")||"";e.find('.wpz-insta-tag[data-product-id="'+t+'"]').remove();var o=i('<div class="wpz-insta-tag" data-product-id="'+t+'" data-x="'+n+'" data-y="'+a+'"><span class="wpz-insta-tag-dot"></span><span class="wpz-insta-tag-label">'+s+"</span></div>");o.css({left:n+"%",top:a+"%"}),e.append(o),U(o)},J=function(t,n){n=n||1,i("#wpz-insta-product-list").html('<div class="wpz-insta-loading">Loading...</div>'),i.ajax({url:zoom_instagram_widget_admin.ajax_url,type:"POST",data:{action:"wpz-insta_get-products",nonce:zoom_instagram_widget_admin.product_link_nonce,search:t||"",page:n},success:function(t){t.success&&t.data.products?j(t.data.products,t.data.pages,n):i("#wpz-insta-product-list").html('<div class="wpz-insta-no-products">No products found.</div>')},error:function(){i("#wpz-insta-product-list").html('<div class="wpz-insta-error">Error loading products.</div>')}})},j=function(t,n,a){var e="",s=zoom_instagram_widget_admin.strings||{},o="image"===Q||"carousel_album"===Q,d=F.map(function(t){return t.id});if(0===t.length?e='<div class="wpz-insta-no-products">No products found.</div>':t.forEach(function(t){var i=parseInt(t.id,10),n=-1!==d.indexOf(i),a=y(i);if(e+='<div class="wpz-insta-product-item'+(n?" selected":"")+(a?" has-tag":"")+'" data-product-id="'+t.id+'" data-product-title="'+encodeURIComponent(t.title)+'" data-product-image="'+encodeURIComponent(t.image)+'"><span class="wpz-insta-product-item-checkbox" aria-hidden="true"></span><img src="'+t.image+'" alt="" /><div class="wpz-insta-product-info"><h4>'+t.title+'</h4><span class="wpz-insta-product-price">'+t.price+"</span></div>",o){var p="button wpz-insta-tag-in-image-btn"+(a?" wpz-insta-tag-btn--tagged":""),r=a?s.editTag||"Edit Tag":s.tagInImage||"Tag in Image";e+='<button type="button" class="'.concat(p,'" title="').concat(r,'">\n\t\t\t\t\t\t\t').concat('<svg xmlns="http://www.w3.org/2000/svg" height="18" viewBox="0 -960 960 960" width="18" fill="currentColor"><path d="M640-760v280l68 68q6 6 9 13.5t3 15.5v23q0 17-11.5 28.5T680-320H520v234q0 17-11.5 28.5T480-46q-17 0-28.5-11.5T440-86v-234H280q-17 0-28.5-11.5T240-360v-23q0-8 3-15.5t9-13.5l68-68v-280q-17 0-28.5-11.5T280-800q0-17 11.5-28.5T320-840h320q17 0 28.5 11.5T680-800q0 17-11.5 28.5T640-760Z"></path></svg>'," ").concat(r,"\n\t\t\t\t\t\t</button>")}e+="</div>"}),i("#wpz-insta-product-list").html(e),n>1){var p="";a>1&&(p+='<button type="button" class="button wpz-insta-prev-page" data-page="'+(a-1)+'">Previous</button>'),a<n&&(p+='<button type="button" class="button wpz-insta-next-page" data-page="'+(a+1)+'">Next</button>'),i(".wpz-insta-product-pagination").html(p)}else i(".wpz-insta-product-pagination").html("");var r=!I(F,G);i(".wpz-insta-save-link").prop("disabled",!r),i(".wpz-insta-remove-link").prop("disabled",!F.length>0)},M=function(t){(t=Array.isArray(t)?t:[]).length>0?Z[H]=t:Z[H]=[],v();var i=t.length>0;!function(t,i){var n=document.querySelector("#wpz-insta_widget-preview-view iframe");n&&n.contentWindow&&n.contentWindow.postMessage({action:"wpz-insta-product-link-update",mediaId:t,hasLinks:i,productIds:i?k(t):[]},"*")}(H,i),A.hide()},A=null,H=null,W=null,F=[],G=[],Q="image",B="",Y=[],X=null,K=null,Z={},$={},V=null;window.addEventListener("message",function(t){if(t.data&&"wpz-insta-open-product-link"===t.data.action){if(!zoom_instagram_widget_admin.is_pro)return function(){if(!V){var t=zoom_instagram_widget_admin.strings||{},n=t.productLinksUpsellTitle||"Unlock Product Links",a=t.productLinksUpsellMessage||"Link your Instagram posts to WooCommerce products and display the product details or a Buy now button. This feature is available with an active Instagram Widget PRO license.",e=t.productLinksUpsellCta||"Get PRO License",s=t.productLinksUpsellClose||"Close",o=zoom_instagram_widget_admin.product_links_upsell_url||"https://www.wpzoom.com/plugins/instagram-widget/",d=zoom_instagram_widget_admin.product_links_upsell_image_url||"",p='<div id="wpz-insta-product-links-upsell-modal" class="wpz-insta-modal wpz-insta-upsell-modal" style="display: none;"><div class="wpz-insta-modal-content wpz-insta-upsell-content"><div class="wpz-insta-modal-header"><h2>'+n+'</h2><button type="button" class="wpz-insta-modal-close">&times;</button></div><div class="wpz-insta-modal-body">'+(d?'<img src="'+d+'" alt="" class="wpz-insta-upsell-image" />':"")+'<p class="wpz-insta-upsell-message">'+a+'</p><div class="wpz-insta-upsell-actions"><a href="'+o+'" target="_blank" rel="noopener" class="button button-primary wpz-insta-upsell-cta">'+e+'</a></div></div><div class="wpz-insta-modal-footer"><button type="button" class="button wpz-insta-upsell-close">'+s+"</button></div></div></div>";i("body").append(p),(V=i("#wpz-insta-product-links-upsell-modal")).on("click",".wpz-insta-modal-close, .wpz-insta-upsell-close",function(){V.hide()})}}(),void V.show();H=t.data.mediaId||"",W=t.data.feedId||"",Q=t.data.mediaType||"image",B=t.data.imageUrl||"",Y=[],function(){if(!A){0===i("#wpz-insta-pending-product-links").length&&i("form#post").append('<input type="hidden" id="wpz-insta-pending-product-links" name="_wpz-insta_pending-product-links" value="" />');var t,n=zoom_instagram_widget_admin.strings||{},a='<div id="wpz-insta-product-link-modal" class="wpz-insta-modal" style="display: none;"><div class="wpz-insta-modal-content"><div class="wpz-insta-modal-header"><button type="button" class="wpz-insta-back-to-products" style="display: none;" title="'+(n.backToProducts||"Back")+'"><span class="dashicons dashicons-arrow-left-alt2"></span></button><h2 class="wpz-insta-modal-title">'+(n.linkProduct||"Link to Product")+'</h2><div class="wpz-insta-tagging-header-preview" id="wpz-insta-tagging-header-preview" style="display: none;"></div><button type="button" class="wpz-insta-modal-close">&times;</button></div><div class="wpz-insta-modal-body"><div class="wpz-insta-product-selection-view"><p class="wpz-insta-product-link-hint">'+(n.selectProductsHint||"Select one or more products. Click an item to toggle selection.")+'</p><div class="wpz-insta-product-search"><input type="text" id="wpz-insta-product-search-input" placeholder="'+(n.searchProducts||"Search products...")+'" /></div><div class="wpz-insta-product-list" id="wpz-insta-product-list"></div><div class="wpz-insta-product-pagination"></div></div><div class="wpz-insta-album-selector-view" style="display: none;"><p class="wpz-insta-album-hint">'+(n.selectAlbumImage||"Select an image from the album to tag the product on:")+'</p><div class="wpz-insta-album-images" id="wpz-insta-album-images"></div></div><div class="wpz-insta-tagging-view" style="display: none;"><div id="wpz-insta-tagging-product-info" style="display: none;"></div><p class="wpz-insta-tagging-hint">'+(n.taggingHint||"Click on the image to place the product tag. You can drag to reposition.")+'</p><div class="wpz-insta-tagging-canvas-wrap"><img id="wpz-insta-tagging-image" src="" alt="" /><div class="wpz-insta-tagging-tags" id="wpz-insta-tagging-tags"></div></div></div></div><div class="wpz-insta-modal-footer"><div class="wpz-insta-modal-footer-right"><button type="button" class="button wpz-insta-remove-link" disabled>'+(n.removeLink||"Remove Link")+'</button></div><div class="wpz-insta-modal-footer-left"><button type="button" class="button button-primary wpz-insta-save-link" disabled>'+(n.save||"Save")+'</button><button type="button" class="button wpz-insta-cancel-link">'+(n.cancel||"Cancel")+'</button></div></div><div class="wpz-insta-tagging-footer" style="display: none;"><div class="wpz-insta-modal-footer-right"><button type="button" class="button wpz-insta-remove-tag-position" disabled>'+(n.removeTagPosition||"Remove tag position")+'</button></div><div class="wpz-insta-modal-footer-left"><button type="button" class="button button-primary wpz-insta-save-link">'+(n.save||"Save")+'</button><button type="button" class="button wpz-insta-cancel-link">'+(n.cancel||"Cancel")+"</button></div></div></div></div>";i("body").append(a),(A=i("#wpz-insta-product-link-modal")).on("click",".wpz-insta-modal-close, .wpz-insta-cancel-link",function(){x(),A.hide()}),A.on("click",".wpz-insta-remove-link",function(){M([])}),A.on("click",".wpz-insta-save-link",function(){var t=JSON.parse(JSON.stringify(F));M(t)}),A.on("click",".wpz-insta-tag-in-image-btn",function(t){t.stopPropagation();var n=i(this).closest(".wpz-insta-product-item"),a=parseInt(n.data("product-id"),10),e=decodeURIComponent(n.data("product-title")||""),s=decodeURIComponent(n.data("product-image")||"");X=a,"carousel_album"===Q?T(a,e,s):D(a,e,s,B)}),A.on("click",".wpz-insta-back-to-products",function(){x()}),A.on("click",".wpz-insta-remove-tag-position",function(){i(this).prop("disabled")||R()}),A.on("click",".wpz-insta-album-image-item",function(){var t=i(this).data("image-url"),n=i(this).data("image-index");K=n;var a=i("#wpz-insta-tagging-product-info").data("product-title")||"",e=i("#wpz-insta-tagging-product-info").data("product-image")||"";D(X,a,e,t)}),A.on("click","#wpz-insta-tagging-image",function(t){var n=i(this),a=n.offset(),e=(t.pageX-a.left)/n.width()*100,s=(t.pageY-a.top)/n.height()*100;e=Math.max(0,Math.min(100,e)),s=Math.max(0,Math.min(100,s)),P(X,e,s)}),A.on("click",".wpz-insta-product-item",function(){var t=parseInt(i(this).data("product-id"),10),n=C(F,t);-1===n?(F.push({id:t,tag:null}),i(this).addClass("selected")):(F.splice(n,1),i(this).removeClass("selected has-tag")),function(t,i){var n=t.find(".wpz-insta-tag-in-image-btn");if(0!==n.length){var a=zoom_instagram_widget_admin.strings||{},e=y(i),s='<svg xmlns="http://www.w3.org/2000/svg" height="18" viewBox="0 -960 960 960" width="18" fill="currentColor"><path d="M640-760v280l68 68q6 6 9 13.5t3 15.5v23q0 17-11.5 28.5T680-320H520v234q0 17-11.5 28.5T480-46q-17 0-28.5-11.5T440-86v-234H280q-17 0-28.5-11.5T240-360v-23q0-8 3-15.5t9-13.5l68-68v-280q-17 0-28.5-11.5T280-800q0-17 11.5-28.5T320-840h320q17 0 28.5 11.5T680-800q0 17-11.5 28.5T640-760Z"></path></svg>',o=e?a.editTag||"Edit Tag":a.tagInImage||"Tag in Image";e?n.addClass("wpz-insta-tag-btn--tagged").html(s+" "+o).attr("title",o):n.removeClass("wpz-insta-tag-btn--tagged").html(s+" "+o).attr("title",o)}}(i(this),t);var a=!I(F,G);i(".wpz-insta-save-link").prop("disabled",!a),i(".wpz-insta-remove-link").prop("disabled",!F.length>0)}),i("#wpz-insta-product-search-input").on("input",function(){clearTimeout(t);var n=i(this).val();t=setTimeout(function(){J(n,1)},500)})}}(),function(){X=null,K=null;var t=zoom_instagram_widget_admin.strings||{};A.find(".wpz-insta-modal-title").text(t.linkProduct||"Link to Product"),A.find("#wpz-insta-tagging-header-preview").hide().empty(),A.find(".wpz-insta-product-selection-view").show(),A.find(".wpz-insta-album-selector-view").hide(),A.find(".wpz-insta-tagging-view").hide(),A.find(".wpz-insta-back-to-products").hide(),A.find(".wpz-insta-modal-footer").show(),A.find(".wpz-insta-tagging-footer").hide(),i("#wpz-insta-tagging-tags").empty(),i("#wpz-insta-tagging-image").attr("src","")}(),A.show(),i("#wpz-insta-product-list").html('<div class="wpz-insta-loading">Loading...</div>'),i(".wpz-insta-save-link").prop("disabled",!0),H in Z?(F=JSON.parse(JSON.stringify(Z[H])),G=JSON.parse(JSON.stringify(F)),i(".wpz-insta-remove-link").prop("disabled",!F.length>0),J("",1)):i.ajax({url:zoom_instagram_widget_admin.ajax_url,type:"POST",data:{action:"wpz-insta_get-product-link",nonce:zoom_instagram_widget_admin.product_link_nonce,feed_id:W,media_id:H},success:function(t){t.success&&t.data&&t.data.products&&Array.isArray(t.data.products)?(F=t.data.products.slice(),$[H]=JSON.parse(JSON.stringify(t.data.products))):t.success&&t.data&&t.data.product_ids&&Array.isArray(t.data.product_ids)?(F=t.data.product_ids.map(function(t){return{id:t,tag:null}}),$[H]=JSON.parse(JSON.stringify(F))):(F=[],$[H]=[]),G=JSON.parse(JSON.stringify(F)),i(".wpz-insta-remove-link").prop("disabled",!F.length>0),J("",1)},error:function(){F=[],G=[],$[H]=[],i(".wpz-insta-remove-link").prop("disabled",!0),J("",1)}})}}),i(document).on("click",".wpz-insta-prev-page, .wpz-insta-next-page",function(){var t=i(this).data("page"),n=i("#wpz-insta-product-search-input").val();J(n,t)})}var tt={},it={};function nt(t){var n,a=function(t){return t in tt?tt[t]:!!it[t]}(t),e=!a;tt[t]=e,!!it[t]===e&&delete tt[t],(n=i("#wpz-insta-pending-hidden-posts")).length&&n.val(JSON.stringify(tt)),i.isEmptyObject(tt)?"_wpz-insta_pending-hidden-posts"in l&&delete l["_wpz-insta_pending-hidden-posts"]:"_wpz-insta_pending-hidden-posts"in l||(l["_wpz-insta_pending-hidden-posts"]=!0),i("input#publish").toggleClass("disabled",i.isEmptyObject(l));var s=document.querySelector("#wpz-insta_widget-preview-view iframe");s&&s.contentWindow&&s.contentWindow.postMessage({action:"wpz-insta-moderate-update",mediaId:t,hidden:e},"*")}!function(){if(0===i("#wpz-insta-pending-hidden-posts").length&&i("form#post").append('<input type="hidden" id="wpz-insta-pending-hidden-posts" name="_wpz-insta_pending-hidden-posts" value="" class="preview-exclude" />'),"undefined"!=typeof zoom_instagram_widget_admin&&zoom_instagram_widget_admin.hidden_posts)try{var t="string"==typeof zoom_instagram_widget_admin.hidden_posts?JSON.parse(zoom_instagram_widget_admin.hidden_posts):zoom_instagram_widget_admin.hidden_posts;Array.isArray(t)&&t.forEach(function(t){it[t]=!0})}catch(t){}}(),window.addEventListener("message",function(t){if(t.data&&"wpz-insta-toggle-visibility"===t.data.action){var i=t.data.mediaId||"";i&&nt(i)}})})})();